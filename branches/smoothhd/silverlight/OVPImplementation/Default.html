<!-- <$@ Options LaunchPage="true"$> -->
<!-- <$@ Options Name="Silverlight 2 Gallery"$> -->
<!-- <$@ Options TemplatePreviewImage="preview.JPG"$> -->
<!-- <$@ Parameter Name="AutoPlay" Caption="Automatically start video when cued" Tooltip="Select to begin playback when video is loaded" Type="System.Boolean" Default="True" $> -->
<!-- <$@ Parameter Name="EnableCaptions" Caption="Allow closed captions to show" Tooltip="Select to allow closed caption text over video during playback"Type="System.Boolean" Default="True" $> -->
<!-- <$@ Parameter Name="Muted" Caption="Mute player on start" Tooltip="Select to begin playback in a muted state" Type="System.Boolean" Default="False" $> -->
<!-- <$@ Parameter Name="StretchMode" Caption="Stretch Mode" Tooltip="Change the way the template is displayed on the page" Type="System.Enum" EnumValues="None=0,Uniform=1,UniformToFill=2,Fill=3" Default="None" $> -->
<!-- <$@ Parameter Name="BackgroundColor" Caption="Player background color" Tooltip="Select web page background color" Type="System.Windows.Media.Color" Default="black" $> -->
<!-- <$@ Parameter Name="AllowedCodecs" Caption="Allowed Codecs" Tooltip="Codecs template supports" Hidden="true" Type="System.String" Default="VC1,WMA" $> -->
<!-- <$@ Capabilities Value="silverlight20,audio,video,captions,chapters,gallery,supports16by9,supports4by3,webbrowsable" $> -->
<!-- <$@ ScriptCommands Value="caption" $> -->
<!-- <$@ IgnoreDirectory Value="Source" $> -->
<!--
<$@ Import Namespace="System.IO" $><script runat="authoring">
	
    string EscapeString(string value)
	{
	    if(string.IsNullOrEmpty(value))
	    {
	        return value;
	    }
	    value = value.Replace("\\", "\\\\");
	    value = value.Replace("\"", "\\\"");
	    value = value.Replace("\'", "%27");
	    value = value.Replace("&", "%26");
	    value = System.Uri.EscapeUriString(value);
	    return value;
	}
	
	string ChapterTitleXML(PublishedMarker marker)
	{
	    return " title=\""+EscapeString(marker.Value)+"\"";
	}
	
	string ChapterImageXML(PublishedMarker marker)
	{
        string strUrl = (marker.ThumbnailPath!=null)?EscapeString(marker.ThumbnailPath):"";
		if (String.IsNullOrEmpty(strUrl))
		{
		    return "";
	    }
		return " thumbnailSource=\""+strUrl+"\"";
	}
	
	string ChapterPositionXML(PublishedMarker marker)
	{
	    return " position=\""+String.Format("{0:0.000}",marker.Time.TotalSeconds)+"\"";
	}
	
	string PlayListParam()
	{
	    string result = "<playList><playListItems>";
	    
	    for(int iItem=0;iItem<PublishedItems.Length;iItem++)
	    {
	        result += "<playListItem"
	        + " title=\"" + EscapeString(PublishedItems[iItem].MediaItem.Metadata[MetadataNames.Title]) + "\""
	        + " description=\"" + EscapeString(PublishedItems[iItem].MediaItem.Metadata[MetadataNames.Description]) + "\""
	        + " mediaSource=\"" + EscapeString(PublishedItems[iItem].OutputFileName) + ((PublishedItems[iItem].MediaItem.FileOutputMode == Microsoft.Expression.Encoder.FileOutputMode.IisSmoothStreamingMultipleFile) ? "\\Manifest" : "") + "\""
	        + " adaptiveStreaming=\"" + (PublishedItems[iItem].MediaItem.FileOutputMode == Microsoft.Expression.Encoder.FileOutputMode.IisSmoothStreamingMultipleFile || PublishedItems[iItem].MediaItem.FileOutputMode == Microsoft.Expression.Encoder.FileOutputMode.ChunkedFile) + "\""	        
	        + " thumbSource=\"" + EscapeString(PublishedItems[iItem].ThumbnailPath) + "\" >";

            if (PublishedItems[iItem].Markers.Count>0) 
            {
                result += "<chapters>";
                for (int iMarker=0;iMarker<PublishedItems[iItem].Markers.Count;iMarker++)
                {
                    PublishedMarker marker = PublishedItems[iItem].Markers[iMarker];
                    result += "<chapter " + ChapterPositionXML(marker) + ChapterImageXML(marker) + ChapterTitleXML(marker) + " />";
                }
                result += "</chapters>";
            }
	        result += "</playListItem>";
	    }
        result += "</playListItems></playList>";	    	
        var div = getElementById('text');
        div.innerHTML = result;
        return result;
	}     
</script> 
-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>OpenVideoPlayer Test Page </title>

    <style type="text/css">
    html, body {
	    height: 100%;
	    overflow: auto;
    }
    body {
	    padding: 0;
	    margin: 0;
    }
    #silverlightControlHost {
	    height: 100%;
    }
    </style>
    
    <script type="text/javascript">
        function onSilverlightError(sender, args) {
        
            var appSource = "";
            if (sender != null && sender != 0) {
                appSource = sender.getHost().Source;
            } 
            var errorType = args.ErrorType;
            var iErrorCode = args.ErrorCode;
            
            var errMsg = "Unhandled Error in Silverlight 2 Application " +  appSource + "\n" ;

            errMsg += "Code: "+ iErrorCode + "    \n";
            errMsg += "Category: " + errorType + "       \n";
            errMsg += "Message: " + args.ErrorMessage + "     \n";

            if (errorType == "ParserError")
            {
                errMsg += "File: " + args.xamlFile + "     \n";
                errMsg += "Line: " + args.lineNumber + "     \n";
                errMsg += "Position: " + args.charPosition + "     \n";
            }
            else if (errorType == "RuntimeError")
            {           
                if (args.lineNumber != 0)
                {
                    errMsg += "Line: " + args.lineNumber + "     \n";
                    errMsg += "Position: " +  args.charPosition + "     \n";
                }
                errMsg += "MethodName: " + args.methodName + "     \n";
            }

            throw new Error(errMsg);
        }
    </script>
</head>

<body>
    <!-- Runtime errors from Silverlight will be displayed here.
	This will contain debugging information and should be removed or hidden when debugging is completed -->
	<div id='errorLocation' style="font-size: small;color: Gray;">&nbsp;</div>
    <div id='text' style="font-size: small;color: black;">&nbsp;</div>

    <div id="silverlightControlHost">
		<object data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%">
			<param name="source" value="OVPImplementation.xap"/>
			<param name="onerror" value="onSilverlightError" />
            <!--<param name="initparams" value='fakemode=<$$>,background=<$=TemplateParameter.BackgroundColor$>,autoplay=<$=TemplateParameter.AutoPlay$>,muted=<$=TemplateParameter.Muted$>,stretchmode=<$=TemplateParameter.StretchMode$>,playlist=<$=PlayListParam()$>' />			-->
			<param name="initparams" value='fakemode=true,background=black,autoplay=false,muted=false,stretchmode=<$=TemplateParameter.StretchMode$>,playlist=' />			
			
			<a href="http://go.microsoft.com/fwlink/?LinkID=115261" style="text-decoration: none;">
     			<img src="http://go.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight" style="border-style: none"/>
			</a>
		</object>
		<iframe style='visibility:hidden;height:0;width:0;border:0px'></iframe>
    </div>
</body>
</html>
